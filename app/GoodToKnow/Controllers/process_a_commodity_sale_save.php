<?php

namespace GoodToKnow\Controllers;

class process_a_commodity_sale_save
{
    function page()
    {
        /**
         * Save the commodity and commodity_sold records generated by the previous
         * route. Also, retrieve these records back from the database and present
         * them to the user as confirmation that all went well.
         *
         * Make sure all session variables are destroyed at the end of the script.
         */


        global $g;


        kick_out_loggedoutusers();


        get_db();


        /**
         * The commodity and commodity_sold records are (now) in a state which is appropriate
         * to be saved to the database although at one point in time in the previous route,
         * these records were modified to be human-readable for the confirmation view.
         */

        //$g->saved_arr02 has commodity
        //$g->saved_arr03 has commodity_sold


        /**
         * Update the database with the modified commodity objects.
         */

        foreach ($g->saved_arr02 as $commodity) {

            $result = $commodity->save();

            if (!$result) {

                breakout(' The save method for commodity returned false. ');

            }

            if (!empty($g->message)) {

                breakout(' The save method for commodity did not return false but it did send back a message.
             Therefore, it probably did not create the commodity record. ');

            }

        }


        /**
         * Save to the database the new commodity_sold objects.
         */

        foreach ($g->saved_arr03 as $commodity_sold) {

            $result = $commodity_sold->save();

            if (!$result) {

                breakout(' The save method for commodity_sold returned false. ');

            }

            if (!empty($g->message)) {

                breakout(' The save method for commodity_sold did not return false but it did send
            back a message. Therefore, it probably did not create the commodity_sold record. ');

            }

        }


        /**
         * Outside both foreach loops.
         */


        breakout(" Testing: look at the result read from the database via other features. ");
    }
}